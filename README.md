# Цифровой ППР. Описание задачи

## Процесс составления планов
Ежегодно в каждом предприятии составляются планы выполнения планового-предупредительных работ (далее Годовые планы).
Выглядят они как перечень работ, которые необходимо выполнить в течении года и сколько времени это займет. В Годовом плане всё расписано на каждый месяц.

В этих планах помимо непосредственно обслуживания устройств электроснабжения содержаться различные организационные мероприятия (например, прохождение работниками медицинских осмотров, организация технической учебы).

Первым делом при планировании считается сколько вообще человеко-часов есть (сколько рабочего времени работник отработает) с разбивкой по месяцам.

Далее по каждому разделу разбиваются объемы работ так, чтобы работники были способны его выполнить.

Когда начальник цеха подготовил Годовой план его проверяет инженер тех отдела, нормировщик (инженер по труду и заработной плате), инженер по охране труда, согласует заместитель начальника и утверждает начальник дистанции.

Ежемесячно начальник подразделения составляет ведомость работ на следующий месяц (далее Месячный план). Составляется он на основе Годового плана с учётом невыполненных ранее работ (например работа была не выполнена в марте и перенесена на май или же июнь).
Эти планы проверяет инженер тех отдела, нормировщик, утверждает заместитель начальника.
По завершению месяца в Месячном плане и в Годовом плане ставится отметка об объеме выполненных работ, затраченном времени. Если были выполнены работы вне плана, то они дополнительно прописываются. Делается это зачастую вручную.
Потом печатается/пишется рапорт о невыполненных позициях (что не сделали, в каком объеме, сколько времени на выполнение этой работы нужно было, и почему не выполнили).
Самим начальникам

Задача инженера проверить не наврал ли ему начальник цеха (по ошибке или злому умыслу). При этом не регламентируется как именно должен проверять. И в общем случае паралельно начальнику цеха заполняются годовые планы, сверяются данные по выполнению годовых планов, месячных, рапорта о не выполненных работах.

В вышестоящей структуре тоже должны проверять нас, также это нерегламентировано. По этому какую ответную форму придумают, такой мы и будет отчитываться. Сейчас это заполнить таблицу по затраченному времени на выполнение работ и письменный доклад с перечислением того, что не сделано.

## Проблема
В зависимости от ответственности начальника, его понимания порядка действий, способностями даже просто печатать в ворде, добавить/скрыть строку в ексель на выходе имеем информацию, в которой надо сидеть, пытаться в ней разобраться, обработать.

Помимо бумажной волокиты уже имеется несколько систем автоматизированного планирования, но в них начальники подразделений либо ничего не делают, либо проставляют значения "от фонаря": лишь бы по итоговым трудозатратам/часам цифры были нормальные. Эти автоматизированных системы не упрощают жизнь, не дополняют, а тем более не заменяют работу с бумажной документаций.

## Чего хотелось бы добиться
Для начальников цехов:

- Автоматизировать составление годовых, месяных планов, рапортов по установленным формам, внесение данных выполнения. Тем самым уменьшить затраты времени на их заполнение;
- Подготовка ланов, рапортов, их печать
- Снизить вероятность возникновение ошибок при переносе информации из одного плана в другой, данных о выполнении работ (они ведь дублируются), данных о перенесенных работах.
- Интерфейс должен быть настолько простой, но при этом гибким на добавление/исправление данных. Интерфейс такой, чтобы даже креветка справилась.

Для руководителей дистанции, тех отдела (мое место):

- Согласовывать, утверждать планы.
- Просмотр сводных данных, аналитических таблиц, диаграмм. Крч, смотрят кто, что выполнил, в каком объеме. Например, у нас 14 подразделений. Есть одна сводная таблица с работами и объемами запланированного и выполненного. Нажимаешь мышкой на какие-то позиции и показывается кто что сделал.

Для руководителей выше нас:

- Тоже просто смотрят. Например имеется у них сводная таблица по всем работам по структурам сродни нашей. Нажатием мышки руководител идёт и ищет не выполняющие план цеха, лишает всех премии и думает о том, какой он хороший манагер.
- В общем, наблюдает всякие аналитические справки, данные, таблицы, диаграммы

## Процесс планирования месячного плана выглядит следующим образом:
1. Начальника подразделения на основе Годового плана и предыдущих рапортов о переносе невыполненных позиций планирует Месячный план. Для этого он вручную в ексель документы выбирает нужные работы, скрывая строчки с ненужными, затем проставляет объемы. Отправляет инженера на проверку.
2. Инженер технического отдела проверят заполненный план также на основе годового плана (необходимо просмотреть глазами сотни позиций) и предыдущих рапортов о переносе невыполненных позиций. Передает на утверждение руководителю дистанции.
3. Начальник подразделения вручную заполняет выполнение работ в утвержденном месячном плане. Далее должен составить в word документе рапорт о переносе невыполненных позиций (указать какие именно работы не выполнены, в каком объеме и какие требуется трудозатраты для их выполнения. Также начальник подразделения заполняет Годовой план в графах выполнения.
4. Инженер технического отдела проверяет фактически выполненные работы, проверяет правильность написания рапорта, и также вручную заполняет имеющуюся на руках копию Годового плана для контроля выполнения работ.

Таким образом главным источником всей информации является Годовой план, на основании которой строится вся остальная документация.

## Матрица ролей и их возможностей в зависимости от статуса ППРа

![Роли и статусы](image.png)

# ТЕХ ДОЛГ:
1. При добавлении новой работы не создаю id. Также не проверяю, что добавил.
2. Добавлять новую работу надо по-другому (зная место, куда вставлять)
3. Не отрисовывать нули и пустые значения в таблице

# ИДЕИ И ВОПРОСЫ:
1. Когда создаешь ППР, или копируешь чужой, то автоматически все значения цеха меняются на то, какой цех себе его скопировал
2. Настройки шрифта для таблицы, её ширины
3. Корректировка ППР (процесс нависать)
4. В самом верху ППР табы с выбором таблицы
5. Как выглядят и осуществляется перенос невыполненных позиций. Не будет ли проблем с числами с плавающей точкой? Например, открывается модальное окно или же страница для переноса, выводится список не выполненных позиций и объем, который надо перенести. Какие-то штуки есть, в которых выбираешь месяц и переносимый объем. Аналогично с перевыполненными позициями.
6. Есть два вида представления перенесенных позиций: со стрелочками (показываются утвержденные изначально планы, поверх плана стрелочки с переносами) и откорректированный годовой план (стрелочек нет, значения изменены)
7. Люди. Что делать с планируемыми людьми?
8. Где хранить месячные планы и рапорта?
9. Лог данных процесса согласования/утверждения ППР
10. Нужно хранить самый первый вариант ППР для сравнения??? Или же не надо??? В общем, необходимо где-то хранить корректировку. Для работ корректировка заключена в переносе. Нужно хранить с какого месяца на какой переносится и объемы какие. Для чел-.ч нужно хранить значение корректировки на конкретный месяц.
11. В процессе корректирования может кардинально измениться настой часов. Может попросту не хватать людей, появиться новый. Должна быть возможность также корректировать годовой план. Ведь каждый месяц рапорт пишем как раз на его изменение. Итак, начинаем планировать месяц, корректируем человеко часы (даже людей). Должно ли это быть отражено в годовом плане? Да, должно. Вся информация за месяц должна соответствовать году. Мы поменяли инфу о людях, она также от корректировалась в годовом плане. Это должно быть согласовано? Да. Значит нужен рапорт об изменении ППР при процессе его согласования и утверждения. При изменении увеличения состава бригады можно выполнить позиции из будущих периодов или же выполнить ранее перенесенные позиции на последующие месяцы. Или же что-то перенести сразу (ты знаешь, что тебе не предоставят какое-нибудь глухое окно). А если стало меньше человеко-часов, то можно перенести что-либо на будущие периоды по причине не хватки человеко-часов. В рапорте автоматически формируются данные.
12. А что если человек попробует создать ППР, трудозатраты работ которого не соответствуют человеко-часам? Должна быть ошибка. Просто не дать отправить на солгласование и сказать об ошибке, предложить перенести/добрать позиции. Учесть нужно погрешность и оставить погрешность какую-либо.
13. Что делать, если ЦРБ отменило работы? Как отредактировать то, что было перенесено давно? Можно открывать для редактирования любой месяц, переносить можно только на будущие НЕ ЗАВЕРШЕННЫЕ периоды (след/текущ месяц или же год). Прошедшие планы откорректировать нельзя, только факт.
14. А что если я захочу добавить работу в годовой план в процессе создания месячного? Как это хранить? Просто добавлять строку. Временно созданную строку можно удалить. Утвержденную работу в годовом или месячно планировании нельзя.
15. Сбоку также добавить раздел "НА СОГЛАСОВАНИИ", "НА УТВЕРЖДЕНИИ". Или же колокольчик, в котором будут приходить уведомления

# БАГИ:
1. При обновлении страницы ppr/:id происходит бесконечная перезапись контекста. Быть может избавиться от контектса? Данный баг только в дев режиме (вроде как)
2. По-моему как-то странно обновляется контекст с ППРами. Будто только после перезагрузки он начинает менять значения
